#!/usr/bin/env ruby
$:.unshift(File.join(File.dirname(__FILE__), '..', 'lib'))
require 'wool'

settings = {:fix => true}
scanner = Wool::Scanner.new(settings)
warnings = nil
if ARGV.any?
  ARGV.each do |arg|
    warnings = scanner.scan(File.read(arg), arg)
  end
else
  warnings = scanner.scan(STDIN.read(), '(stdin)')
end

num_fixable = warnings.select { |warning| warning.line != warning.fix(nil) }.size
num_total = warnings.size

results = "#{num_total} warnings found. #{num_fixable} are fixable."
puts results
puts "=" * results.size

warnings.each do |warning|
  puts "#{warning.file}:#{warning.line_number} #{warning.name} (#{warning.severity}) - #{warning.desc}"
end